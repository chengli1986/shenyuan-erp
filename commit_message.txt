fix: 系统性修复申购单审批按钮无响应问题并完善工作流系统

## 核心问题修复
- 修复申购单详情页面审批/拒绝按钮点击无响应的关键问题
- 根本原因：Modal.confirm组件在处理复杂表单内容时无法正确触发回调函数
- 影响范围：部门主管和总经理的所有审批操作完全失效

## 技术解决方案
### 1. Modal组件架构重构
- 将有问题的Modal.confirm替换为可控的Modal组件
- 实现统一的状态管理：approvalVisible, approvalType, approvalForm
- 支持4种审批类型：approve, reject, final_approve, final_reject

### 2. 前端组件优化
- 修复前端API调用不统一问题：统一使用services/api.ts
- 优化供应商询价表单：添加联系人全名、物料级付款方式
- 移除重复的预计交货日期字段，避免用户困惑
- 修复付款方式从下拉菜单改为手动输入，提升业务灵活性

### 3. 后端API修复
- 修复枚举比较错误：current_user.role.value == "project_manager"
- 解决UnboundLocalError：添加完整的else分支处理
- 修复日期格式处理：支持YYYY-MM-DDTHH:mm:ss格式
- 优化错误处理和调试日志输出

### 4. 权限系统完善
- 实现采购员删除权限：单个删除API添加purchaser角色支持
- 建立回归测试机制：scripts/regression_test_checklist.py
- 创建调试工具：frontend/public/debug-console-quote.html

## 修复成果验证
✅ 完整审批流程测试通过：
- 项目经理提交：draft → submitted
- 采购员询价：submitted → price_quoted
- 部门主管审批：price_quoted → dept_approved/rejected
- 总经理最终审批：dept_approved → final_approved/rejected

✅ 技术质量保障：
- 前端编译：0个TypeScript错误，0个ESLint警告
- API集成：统一认证机制，规范错误处理
- 状态管理：受控Modal组件，避免状态冲突
- 用户体验：清晰审批界面，必填字段验证

## 核心技术突破
### Modal组件使用最佳实践
```typescript
// ❌ 避免：Modal.confirm + 复杂表单
Modal.confirm({ content: <Form>...</Form> });

// ✅ 推荐：受控Modal + 状态管理
<Modal visible={visible} onOk={handleSubmit}>
  <Form>...</Form>
</Modal>
```

### React状态管理模式
- 类型化状态定义：ApprovalType枚举
- 统一处理函数：handleApprovalSubmit
- 条件渲染：根据approvalType动态显示表单

### API调用规范化
- 统一使用services/api.ts替代直接fetch调用
- 自动JWT token处理和401错误重定向
- 避免Modal.confirm中的复杂异步操作

## 申购单工作流系统最终状态
🎉 **完整工作流支持**：
1. 📝 申购单创建：智能物料选择、系统分类、数量验证
2. 📤 提交审批：状态流转和权限控制
3. 💰 采购员询价：供应商信息、价格管理、付款方式
4. 👔 部门主管审批：批准/拒绝表单、必填理由验证
5. 👑 总经理最终审批：最终决策、完整审批记录
6. 📊 工作流历史：操作时间线、状态变更追踪

## 文档更新
- 更新README.md：添加审批按钮修复详细技术方案
- 更新CLAUDE.md：记录完整的调试过程和解决方案
- 技术debt清理：移除未使用变量和导入
- 最佳实践总结：Modal组件、React状态管理、API调用规范

## 影响范围
- 申购单模块：从简化版(v1.0)升级为企业级完整工作流(v2.0)
- 前端架构：建立受控组件优先的设计原则
- 调试方法论：分层诊断策略和系统化问题定位
- 开发规范：API调用标准化和错误处理最佳实践

这次修复不仅解决了当前的审批按钮问题，更建立了完整的申购审批工作流系统，
为企业级ERP应用奠定了坚实的技术基础。

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
