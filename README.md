# æ·±æºERPç³»ç»Ÿ

ä¸€ä¸ªä¸“ä¸ºå·¥ç¨‹é¡¹ç›®ç®¡ç†è€Œè®¾è®¡çš„ä¼ä¸šèµ„æºè§„åˆ’(ERP)ç³»ç»Ÿï¼Œæä¾›é¡¹ç›®ç®¡ç†ã€åˆåŒæ¸…å•ç®¡ç†ã€æ–‡ä»¶ç®¡ç†å’Œç³»ç»Ÿæµ‹è¯•ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ç›®å½•

- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [åŠŸèƒ½æ¨¡å—](#åŠŸèƒ½æ¨¡å—)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [å¼€å‘æœ€ä½³å®è·µ](#å¼€å‘æœ€ä½³å®è·µ)

## æŠ€æœ¯æ ˆ

### åç«¯
- **FastAPI** - ç°ä»£é«˜æ€§èƒ½Python Webæ¡†æ¶
- **SQLAlchemy** - Python SQLå·¥å…·åŒ…å’ŒORM
- **PostgreSQL/SQLite** - æ•°æ®åº“
- **Uvicorn** - ASGIæœåŠ¡å™¨

### å‰ç«¯
- **React 19** - ç”¨æˆ·ç•Œé¢åº“
- **TypeScript** - ç±»å‹å®‰å…¨çš„JavaScript
- **Ant Design** - ä¼ä¸šçº§UIç»„ä»¶åº“
- **Axios** - HTTPå®¢æˆ·ç«¯
- **React Router** - è·¯ç”±ç®¡ç†

## åŠŸèƒ½æ¨¡å—

- âœ… **é¡¹ç›®åŸºç¡€ç®¡ç†** - é¡¹ç›®åˆ›å»ºã€ç¼–è¾‘ã€çŠ¶æ€ç®¡ç†
- âœ… **åˆåŒæ¸…å•ç®¡ç†** - Excelå¯¼å…¥ã€æ¸…å•è§£æã€è®¾å¤‡ç®¡ç†
- âœ… **ç³»ç»Ÿæµ‹è¯•ç®¡ç†** - è‡ªåŠ¨åŒ–æµ‹è¯•ã€ç»“æœç›‘æ§ã€ç»Ÿè®¡åˆ†æ
- âœ… **é‡‡è´­è¯·è´­æ¨¡å—** - ç®€åŒ–ç‰ˆé‡‡è´­ç”³è¯·å•ç®¡ç† (v1.0)
- ğŸš§ **ç³»ç»Ÿåˆ†ç±»ç®¡ç†** - è®¾å¤‡åˆ†ç±»ä½“ç³»ä¼˜åŒ–

### é‡‡è´­è¯·è´­æ¨¡å— (v1.0)

**å¼€å‘åŸåˆ™**ï¼šé‡‡ç”¨"å°æ­¥å¿«è·‘ã€å±€éƒ¨åŠŸèƒ½éªŒè¯"çš„è¿­ä»£å¼€å‘æ¨¡å¼

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… ç®€åŒ–ç‰ˆç”³è´­å•åˆ›å»º - åŸºç¡€ä¿¡æ¯å½•å…¥å’Œæäº¤
- âœ… ç”³è´­å•åˆ—è¡¨æŸ¥çœ‹ - å®Œæ•´åˆ†é¡µæ˜¾ç¤ºå’ŒçŠ¶æ€æŸ¥è¯¢
- âœ… ç”³è´­å•è¯¦æƒ…æŸ¥çœ‹ - å¼¹çª—å±•ç¤ºå®Œæ•´ä¿¡æ¯
- âœ… é¡¹ç›®åç§°æ˜¾ç¤º - æ›¿ä»£é¡¹ç›®IDå±•ç¤ºï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- âœ… åˆ†é¡µåŠŸèƒ½å®Œå–„ - æ”¯æŒ20/50/100æ¡è®°å½•æ˜¾ç¤ºé€‰æ‹©

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- **ç®€åŒ–ç‰ˆæ•°æ®æ¨¡å‹**ï¼šé¿å…å¤æ‚çš„å®¡æ‰¹æµç¨‹ï¼Œä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½
- **ç±»å‹å®‰å…¨è®¾è®¡**ï¼šå®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- **å“åº”å¼UI**ï¼šåŸºäºAnt Designçš„ç°ä»£åŒ–ç•Œé¢
- **å®æ—¶åˆ·æ–°æœºåˆ¶**ï¼šåˆ›å»ºåè‡ªåŠ¨åˆ·æ–°åˆ—è¡¨æ•°æ®

**æ–‡ä»¶ç»“æ„**ï¼š
```
backend/app/models/purchase.py      # é‡‡è´­æ•°æ®æ¨¡å‹
backend/app/schemas/purchase.py     # APIæ•°æ®æ ¡éªŒ
backend/app/api/v1/purchases.py     # RESTful APIæ¥å£

frontend/src/types/purchase.ts      # TypeScriptç±»å‹å®šä¹‰
frontend/src/services/purchase.ts   # APIè°ƒç”¨æœåŠ¡
frontend/src/pages/Purchase/        # å‰ç«¯é¡µé¢ç»„ä»¶
  â”œâ”€â”€ SimplePurchaseList.tsx       # ç”³è´­å•åˆ—è¡¨
  â”œâ”€â”€ SimplePurchaseForm.tsx       # ç”³è´­å•è¡¨å•
  â””â”€â”€ SimplePurchaseDetail.tsx     # ç”³è´­å•è¯¦æƒ…
```

**è®¾è®¡å†³ç­–**ï¼š
- é‡‡ç”¨ç®€åŒ–çš„å•è¡¨è®¾è®¡ï¼Œé¿å…å¤æ‚çš„å…³è”å…³ç³»
- ä½¿ç”¨å¼¹çª—æ¨¡å¼å±•ç¤ºè¯¦æƒ…ï¼Œå‡å°‘é¡µé¢è·³è½¬
- å®ç°é¡¹ç›®åç§°è§£æï¼Œæå‡æ•°æ®å¯è¯»æ€§
- é¢„ç•™æ‰©å±•æ¥å£ï¼Œæ”¯æŒæœªæ¥åŠŸèƒ½è¿­ä»£

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- Node.js 16+
- NPM 8+

### ä¸€é”®å¯åŠ¨è„šæœ¬

#### ğŸ”µ å¼€å‘æ¨¡å¼
```bash
./scripts/start-erp-dev.sh
```
- **å‰ç«¯**ï¼šReactå¼€å‘æœåŠ¡å™¨ (ç«¯å£3000ï¼Œçƒ­é‡è½½)
- **APIè¿æ¥**ï¼šlocalhost:8000 (æœ¬åœ°)
- **é€‚ç”¨**ï¼šVSCode Remote SSHå¼€å‘
- **è®¿é—®**ï¼šhttp://18.219.25.24:3000

#### ğŸŸ  ç”Ÿäº§æ¨¡å¼  
```bash
./scripts/start-erp-prod.sh
```
- **å‰ç«¯**ï¼šserveé™æ€æœåŠ¡å™¨ (ç«¯å£8080ï¼Œæ€§èƒ½ä¼˜åŒ–)
- **APIè¿æ¥**ï¼š18.219.25.24:8000 (å…¬ç½‘)
- **é€‚ç”¨**ï¼šç”Ÿäº§éƒ¨ç½²ã€æ¼”ç¤ºå±•ç¤º
- **è®¿é—®**ï¼šhttp://18.219.25.24:8080

#### ğŸ›‘ ç»Ÿä¸€åœæ­¢
```bash
./scripts/stop-erp.sh
```
- åŒæ—¶åœæ­¢å¼€å‘å’Œç”Ÿäº§æ¨¡å¼çš„æ‰€æœ‰æœåŠ¡

> ğŸ“ **è¯¦ç»†è„šæœ¬æ–‡æ¡£**ï¼šæŸ¥çœ‹ [scripts/README.md](scripts/README.md) äº†è§£æ‰€æœ‰è„šæœ¬çš„è¯¦ç»†ç”¨æ³•

#### ğŸ“Š æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | å¼€å‘æ¨¡å¼ (dev) | ç”Ÿäº§æ¨¡å¼ (prod) |
|------|---------------|----------------|
| **å‰ç«¯æœåŠ¡å™¨** | Reactå¼€å‘æœåŠ¡å™¨ | serveé™æ€æœåŠ¡å™¨ |
| **ç«¯å£** | 3000 | 8080 |
| **APIè¿æ¥** | localhost:8000 | 18.219.25.24:8000 |
| **æ„å»º** | æ— éœ€æ„å»º | npm run build |
| **çƒ­é‡è½½** | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **æ€§èƒ½** | å¼€å‘ä¼˜åŒ– | ç”Ÿäº§ä¼˜åŒ– |
| **ä½¿ç”¨åœºæ™¯** | ä»£ç å¼€å‘è°ƒè¯• | ç”Ÿäº§éƒ¨ç½²æ¼”ç¤º |

### æ‰‹åŠ¨å¯åŠ¨

#### åç«¯å¯åŠ¨
```bash
cd backend
python -m venv venv
source venv/bin/activate  # Linux/Mac
pip install -r requirements.txt
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

#### å‰ç«¯å¯åŠ¨
```bash
cd frontend
npm install
export REACT_APP_API_BASE_URL=http://localhost:8000
npm start
```

## å¼€å‘æŒ‡å—

### æ¨èå¼€å‘æ–¹å¼

1. **VSCode + Remote SSH** (æ¨è)
   - ä½¿ç”¨VSCode Remote SSHè¿æ¥æœåŠ¡å™¨
   - å‰ç«¯è®¿é—®: `http://localhost:3000`
   - åç«¯APIæ–‡æ¡£: `http://localhost:8000/docs`

2. **ç¯å¢ƒå˜é‡é…ç½®**
   ```bash
   # å¼€å‘ç¯å¢ƒ
   export HOST=0.0.0.0
   export PORT=3000
   export REACT_APP_API_BASE_URL=http://localhost:8000
   ```

3. **ä»£ç è´¨é‡**
   - ESLinté…ç½®è‡ªåŠ¨æ£€æŸ¥ä»£ç è´¨é‡
   - TypeScriptä¸¥æ ¼æ¨¡å¼
   - Reactæœ€ä½³å®è·µéµå¾ªuseCallback, useEffectç­‰è§„èŒƒ

### é¡¹ç›®ç»“æ„
```
shenyuan-erp/
â”œâ”€â”€ backend/          # FastAPIåç«¯
â”‚   â”œâ”€â”€ app/         
â”‚   â”‚   â”œâ”€â”€ api/     # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ models/  # æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ schemas/ # Pydanticæ¨¡å‹
â”‚   â”‚   â””â”€â”€ utils/   # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ tests/       # å•å…ƒæµ‹è¯•
â”œâ”€â”€ frontend/         # Reactå‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/ # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/     # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ services/  # APIè°ƒç”¨
â”‚   â”‚   â””â”€â”€ types/     # TypeScriptç±»å‹
â””â”€â”€ scripts/          # éƒ¨ç½²è„šæœ¬
```

## UI/UXè®¾è®¡å†³ç­–

### åˆåŒæ¸…å•å±‚çº§å¯¼èˆªè®¾è®¡
**é—®é¢˜èƒŒæ™¯**ï¼šå·¦ä¾§èœå•"åˆåŒæ¸…å•"æ— å“åº”ï¼ŒåŠŸèƒ½å…¥å£ä¸æ˜ç¡®

**è®¾è®¡æ–¹æ¡ˆ**ï¼šé‡‡ç”¨å±‚çº§å¯¼èˆªï¼ˆåŒå…¥å£è®¾è®¡ï¼‰
- **æ€»è§ˆå…¥å£**ï¼šå·¦ä¾§èœå•"åˆåŒæ¸…å•" â†’ åˆåŒæ¸…å•æ€»è§ˆé¡µé¢
- **å¿«é€Ÿå…¥å£**ï¼šé¡¹ç›®åˆ—è¡¨æ“ä½œæŒ‰é’® â†’ ç‰¹å®šé¡¹ç›®åˆåŒç®¡ç†

**ç”¨æˆ·åœºæ™¯**ï¼š
- ç®¡ç†å‘˜/è´¢åŠ¡ï¼šä½¿ç”¨æ€»è§ˆé¡µé¢æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®åˆåŒçŠ¶æ€
- é¡¹ç›®ç»ç†ï¼šé€šè¿‡é¡¹ç›®åˆ—è¡¨å¿«é€Ÿè®¿é—®è´Ÿè´£é¡¹ç›®çš„åˆåŒ

**å®ç°æ•ˆæœ**ï¼š
- ç»Ÿè®¡å¡ç‰‡å±•ç¤ºå…³é”®æŒ‡æ ‡
- åˆ—è¡¨è§†å›¾æ”¯æŒæœç´¢ç­›é€‰
- çŠ¶æ€Badgeä¼˜é›…å±•ç¤º
- å“åº”å¼è®¾è®¡é€‚é…ä¸åŒå±å¹•

## éƒ¨ç½²æŒ‡å—

### å¼€å‘ç¯å¢ƒéƒ¨ç½²
```bash
./scripts/start-erp-dev.sh
```
**ç‰¹ç‚¹**ï¼šReactçƒ­é‡è½½å¼€å‘æœåŠ¡å™¨ï¼Œæœ¬åœ°APIè¿æ¥ï¼Œé€‚åˆå¼€å‘è°ƒè¯•

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
./scripts/start-erp-prod.sh
```
**ç‰¹ç‚¹**ï¼šé™æ€æ–‡ä»¶ä¼˜åŒ–æœåŠ¡å™¨ï¼Œå…¬ç½‘APIè¿æ¥ï¼Œé€‚åˆç”Ÿäº§å±•ç¤º

### æœåŠ¡ç›‘æ§
- æŸ¥çœ‹æ—¥å¿—ï¼š`tail -f backend/backend.log` æˆ– `tail -f frontend/frontend.log`
- å¥åº·æ£€æŸ¥ï¼š`curl http://localhost:8000/health`
- åœæ­¢æœåŠ¡ï¼š`./stop-erp.sh`

## æ•…éšœæ’é™¤

### ç”³è´­å•åˆ†é¡µåŠŸèƒ½é—®é¢˜ (2025-08-16)

#### é—®é¢˜åœºæ™¯
ç”¨æˆ·è®¾ç½®æ¯é¡µæ˜¾ç¤º20/50/100æ¡è®°å½•æ—¶ï¼Œé¡µé¢ä»ç„¶åªæ˜¾ç¤º10æ¡è®°å½•ï¼Œåˆ†é¡µåŠŸèƒ½å¤±æ•ˆã€‚

#### æ ¹æœ¬åŸå› 
å‰åç«¯APIå‚æ•°åä¸åŒ¹é…ï¼š
- å‰ç«¯å‘é€ï¼š`page_size=20`
- åç«¯æœŸæœ›ï¼š`size=20`
- ç»“æœï¼šåç«¯ä½¿ç”¨é»˜è®¤å€¼`size=10`

#### å¿«é€Ÿè¯Šæ–­æ–¹æ³•
```bash
# 1. éªŒè¯åç«¯APIæ˜¯å¦æ­£ç¡®å“åº”
curl "http://localhost:8000/api/v1/purchases/?page=1&size=20" -H "Authorization: Bearer $TOKEN"

# 2. æ£€æŸ¥å‰ç«¯APIè°ƒç”¨å‚æ•°
grep -r "page_size" frontend/src/pages/Purchase/
```

#### è§£å†³æ–¹æ¡ˆ
ä¿®æ­£å‰ç«¯APIè°ƒç”¨ä¸­çš„å‚æ•°åï¼š
```typescript
// é”™è¯¯ï¼š
fetch(`/api/v1/purchases/?page=${page}&page_size=${size}`)

// æ­£ç¡®ï¼š
fetch(`/api/v1/purchases/?page=${page}&size=${size}`)
```

#### é¢„é˜²æªæ–½
- APIå¼€å‘æ—¶æ˜ç¡®å®šä¹‰å‚æ•°å‘½åè§„èŒƒ
- å‰åç«¯å¼€å‘åŒæ­¥ç¡®è®¤æ¥å£æ–‡æ¡£
- ä½¿ç”¨TypeScriptæ¥å£å®šä¹‰å¼ºåˆ¶å‚æ•°ä¸€è‡´æ€§

### Reactåº”ç”¨æ— é™åŠ è½½é—®é¢˜ (2025-08-15)

#### é—®é¢˜åœºæ™¯
ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒReactä¸»åº”ç”¨å‡ºç°æ— é™åŠ è½½ï¼Œé¡µé¢æ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚

#### æ ¹æœ¬åŸå› 
å¤æ‚ç»„ä»¶å¯¼å…¥å’ŒçŠ¶æ€ç®¡ç†å¼•èµ·çš„åˆå§‹åŒ–å¾ªç¯ï¼š
- ConnectionProviderç»„ä»¶å¾ªç¯ä¾èµ–
- è¿‡å¤šçš„console.logå½±å“æ€§èƒ½
- useEffectä¾èµ–æ•°ç»„é…ç½®é”™è¯¯

#### è°ƒè¯•ç­–ç•¥
1. **æ¸è¿›å¼ç®€åŒ–**ï¼šåˆ›å»ºæœ€å°å¯è¡Œç‰ˆæœ¬é€æ­¥æ·»åŠ åŠŸèƒ½
2. **ç»„ä»¶åˆ†ç¦»æµ‹è¯•**ï¼šå•ç‹¬æµ‹è¯•é—®é¢˜ç»„ä»¶
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ¸…ç†è°ƒè¯•æ—¥å¿—å’Œæ— æ•ˆä¾èµ–

#### è§£å†³æ–¹æ¡ˆ
```typescript
// ç®€åŒ–è®¤è¯é€»è¾‘
isLoggedIn(): boolean {
  const token = localStorage.getItem('access_token');
  return token !== null && this.currentUser !== null;
}

// ä½¿ç”¨useCallbackä¼˜åŒ–æ€§èƒ½
const loadData = useCallback(async () => {
  // æ•°æ®åŠ è½½é€»è¾‘
}, [dependencies]);
```

### æƒé™ç³»ç»Ÿé›†æˆé—®é¢˜ (2025-08-09)

#### é—®é¢˜åœºæ™¯
ç”¨æˆ·æƒé™ç³»ç»Ÿå¼€å‘åï¼Œç°æœ‰åŠŸèƒ½ï¼ˆå¦‚ç”³è´­æ¨¡å—ï¼‰å‡ºç°æ•°æ®æ— æ³•æ˜¾ç¤ºã€ä¿å­˜å¤±è´¥ç­‰é—®é¢˜ã€‚

#### æ ¹æœ¬åŸå› 
å‰ç«¯APIè°ƒç”¨ç¼ºå°‘JWTè®¤è¯tokenï¼Œå¯¼è‡´401æœªæˆæƒé”™è¯¯ã€‚

**æŠ€æœ¯ç»†èŠ‚**ï¼š
- å‰ç«¯ç›´æ¥ä½¿ç”¨`fetch`è°ƒç”¨è€Œéå°è£…çš„`api`å®ä¾‹
- `api.ts`å·²é…ç½®è‡ªåŠ¨tokené™„åŠ ï¼Œä½†æŸäº›ç»„ä»¶ç»•è¿‡äº†è¯¥æœºåˆ¶
- åç«¯æƒé™é™åˆ¶è¿‡äºä¸¥æ ¼ï¼Œä¸šåŠ¡è§’è‰²æ— æ³•æ‰§è¡Œå¿…è¦æ“ä½œ

#### ç³»ç»ŸåŒ–æ’æŸ¥æ–¹æ³•
```bash
# 1. éªŒè¯åç«¯APIå’Œæ•°æ®å®Œæ•´æ€§
curl -X GET "http://localhost:8000/api/v1/purchases/" \
     -H "Authorization: Bearer $TOKEN"

# 2. æ£€æŸ¥å‰ç«¯APIè°ƒç”¨æ–¹å¼
grep -r "fetch.*api/v1" frontend/src/
# æ‰¾å‡ºç›´æ¥ä½¿ç”¨fetchçš„åœ°æ–¹

# 3. éªŒè¯æƒé™é…ç½®
curl -X POST "http://localhost:8000/api/v1/auth/login" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "username=purchaser&password=purchase123"
```

#### ä¿®å¤æ–¹æ¡ˆ
1. **ç»Ÿä¸€APIè°ƒç”¨æ–¹å¼**
```typescript
// é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨fetch
const response = await fetch('/api/v1/purchases/', {
  headers: { 'Authorization': `Bearer ${token}` }
});

// æ­£ç¡®ï¼šä½¿ç”¨å°è£…çš„apiå®ä¾‹
const response = await api.get('purchases/');
```

2. **è°ƒæ•´åç«¯æƒé™ç­–ç•¥**
```python
# ä¿®å¤å‰ï¼šè¿‡äºä¸¥æ ¼
if current_user.role not in ["project_manager", "admin"]:
    raise HTTPException(status_code=403, detail="åªæœ‰é¡¹ç›®ç»ç†å¯ä»¥åˆ›å»ºç”³è´­å•")

# ä¿®å¤åï¼šç¬¦åˆä¸šåŠ¡éœ€æ±‚
if current_user.role not in ["project_manager", "purchaser", "admin"]:
    raise HTTPException(status_code=403, detail="åªæœ‰é¡¹ç›®ç»ç†å’Œé‡‡è´­å‘˜å¯ä»¥åˆ›å»ºç”³è´­å•")
```

3. **å‰ç«¯é”™è¯¯å¤„ç†**
```typescript
// åœ¨api.tsä¸­æ·»åŠ 401è‡ªåŠ¨å¤„ç†
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('access_token');
      localStorage.removeItem('currentUser');
      window.location.reload();
    }
    return Promise.reject(error);
  }
);
```

#### ç»éªŒæ€»ç»“
1. **æƒé™ç³»ç»Ÿé›†æˆæ£€æŸ¥æ¸…å•**ï¼š
   - [ ] æ‰€æœ‰APIè°ƒç”¨ä½¿ç”¨ç»Ÿä¸€è®¤è¯æœºåˆ¶
   - [ ] åç«¯æƒé™é…ç½®ç¬¦åˆä¸šåŠ¡æµç¨‹éœ€æ±‚
   - [ ] å‰ç«¯æœ‰å®Œå–„çš„401é”™è¯¯å¤„ç†
   - [ ] æ•°æ®åº“åŸæœ‰æ•°æ®å®Œæ•´æ€§éªŒè¯

2. **è°ƒè¯•æŠ€å·§**ï¼š
   - å…ˆéªŒè¯åç«¯APIå’Œæ•°æ®å®Œæ•´æ€§
   - ä½¿ç”¨`grep`æŸ¥æ‰¾å‰ç«¯APIè°ƒç”¨æ¨¡å¼
   - åˆ†è§’è‰²æµ‹è¯•åŠŸèƒ½æƒé™è¾¹ç•Œ
   - æ£€æŸ¥æµè§ˆå™¨Networké¢æ¿å®šä½å…·ä½“é”™è¯¯

### å¸¸è§é—®é¢˜è§£å†³

#### 1. å‰ç«¯æ˜¾ç¤º"åç«¯æœªè¿æ¥"

**ç—‡çŠ¶**ï¼šå‰ç«¯é¡µé¢æ­£å¸¸æ˜¾ç¤ºä½†è¿æ¥çŠ¶æ€æ˜¾ç¤º"æœªè¿æ¥"

**å¯èƒ½åŸå› **ï¼š
- CORSé…ç½®é—®é¢˜
- ç½‘ç»œè¿æ¥é—®é¢˜
- APIç«¯ç‚¹é…ç½®é”™è¯¯

**è§£å†³æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€
curl http://localhost:8000/health

# 2. æ£€æŸ¥å‰ç«¯åˆ°åç«¯CORS
curl -H "Origin: http://localhost:3000" http://localhost:8000/health

# 3. æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :3000
sudo netstat -tlnp | grep :8000

# 4. æ£€æŸ¥CORSé…ç½®ï¼ˆbackend/app/main.pyä¸­ï¼‰
# ç¡®ä¿allow_originsåŒ…å«å‰ç«¯åœ°å€
```

**æœ€ç»ˆè§£å†³**ï¼š
```python
# backend/app/main.py
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000", "http://localhost:3001", ...],
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE", "OPTIONS"],
    allow_headers=["*"],
)
```

#### 2. ç«¯å£å ç”¨ï¼ˆwettyå ç”¨3000ç«¯å£ï¼‰

**ç—‡çŠ¶**ï¼š`Something is already running on port 3000`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥æ‰¾ç«¯å£å ç”¨
sudo netstat -tlnp | grep :3000

# åˆ é™¤wettyæœåŠ¡ï¼ˆå®‰å…¨ï¼Œä¸å½±å“Claude Codeï¼‰
sudo systemctl stop wetty
sudo systemctl disable wetty
sudo rm /etc/systemd/system/wetty.service
sudo systemctl daemon-reload
npm uninstall -g wetty
```

#### 3. ESLintè­¦å‘Šæ¸…ç†

**å¸¸è§è­¦å‘Šç±»å‹**ï¼š
- æœªä½¿ç”¨çš„imports
- useEffectä¾èµ–ç¼ºå¤±
- æœªä½¿ç”¨çš„å˜é‡

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// 1. æ¸…ç†æœªä½¿ç”¨çš„imports
// é”™è¯¯ï¼šimport { Space, Button } from 'antd'; // Spaceæœªä½¿ç”¨
// æ­£ç¡®ï¼šimport { Button } from 'antd';

// 2. ä¿®å¤useEffectä¾èµ–
// é”™è¯¯ï¼šuseEffect(() => { fetchData(); }, []);
// æ­£ç¡®ï¼š
const fetchData = useCallback(async () => {
  // æ•°æ®è·å–é€»è¾‘
}, [dependency1, dependency2]);

useEffect(() => {
  fetchData();
}, [fetchData]);
```

#### 4. APIè¿”å›307é‡å®šå‘

**ç—‡çŠ¶**ï¼šåç«¯è¿”å›: `307 Temporary Redirect`

**åŸå› **ï¼šFastAPIè·¯ç”±æœ«å°¾æ–œæ é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// å‰ç«¯APIè°ƒç”¨ç¡®ä¿è·¯å¾„æ­£ç¡®
// é”™è¯¯ï¼š/api/v1/projects
// æ­£ç¡®ï¼š/api/v1/projects/
```

#### 5. ç¯å¢ƒå˜é‡è®¾ç½®

**ç—‡çŠ¶**ï¼šå‰ç«¯æ— æ³•è¿æ¥APIåœ°å€

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç¡®ä¿åœ¨npm startå‰è®¾ç½®ç¯å¢ƒå˜é‡
export REACT_APP_API_BASE_URL=http://localhost:8000
npm start

# æˆ–åœ¨package.jsonçš„scriptsä¸­é…ç½®
"start": "REACT_APP_API_BASE_URL=http://localhost:8000 react-scripts start"
```

#### 6. ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½é—®é¢˜

**ç—‡çŠ¶**ï¼šåˆåŒæ¸…å•ç‰ˆæœ¬ç®¡ç†ä¸­æŸ¥çœ‹/ä¸‹è½½æŒ‰é’®æ— å“åº”

**é—®é¢˜å®šä½**ï¼š
1. **æŸ¥çœ‹æŒ‰é’®æ— ååº”**ï¼šModal.infoç»„ä»¶è°ƒç”¨å¤±è´¥å¯¼è‡´æŸ¥çœ‹åŠŸèƒ½å¼‚å¸¸
2. **ä¸‹è½½æŒ‰é’®æ— æ•ˆæœ**ï¼šç¼ºå°‘APIä»£ç†é…ç½®å¯¼è‡´è·¨åŸŸè¯·æ±‚å¤±è´¥
3. **APIè·¯å¾„ä¸åŒ¹é…**ï¼šå‰åç«¯APIè·¯å¾„ä¸ä¸€è‡´å¯¼è‡´404é”™è¯¯

**è§£å†³æ­¥éª¤**ï¼š

1. **ä¿®å¤æŸ¥çœ‹åŠŸèƒ½**ï¼š
```typescript
// ç®€åŒ–æ—¥æœŸå’Œæ–‡ä»¶å¤§å°æ ¼å¼åŒ–
render: (value) => new Date(value).toLocaleString()
render: (value) => value ? `${(value / 1024).toFixed(1)} KB` : '-'
```

2. **ä¿®å¤ä¸‹è½½åŠŸèƒ½**ï¼š
```json
// frontend/package.json - æ·»åŠ APIä»£ç†
{
  "proxy": "http://localhost:8000"
}
```

3. **ä¿®å¤APIè·¯å¾„åŒ¹é…**ï¼š
```typescript
// frontend - ç»Ÿä¸€ä½¿ç”¨contract-versionsè·¯å¾„
const downloadUrl = `/api/v1/contracts/projects/${projectId}/contract-versions/${version.id}/download`;
```

```python
# backend/app/api/v1/contracts.py - ç»Ÿä¸€APIè·¯å¾„
@router.get("/projects/{project_id}/contract-versions/{version_id}/download")
```

4. **åç«¯è·¯å¾„ä¿®å¤**ï¼š
```python
# backend/app/api/v1/contracts.py - ä¿®æ­£æ–‡ä»¶è·¯å¾„è®¡ç®—
backend_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(__file__))))
file_path = os.path.join(backend_dir, "uploads", "contracts", version.stored_filename)
```

**éªŒè¯æ­¥éª¤**ï¼š
```bash
# 1. é‡å¯æœåŠ¡åº”ç”¨ä»£ç†é…ç½®
./scripts/stop-erp.sh
./scripts/start-erp-dev.sh

# 2. æµ‹è¯•APIä»£ç†
curl http://localhost:3000/api/v1/contracts/test

# 3. æµ‹è¯•ä¸‹è½½APIï¼ˆæ³¨æ„ä½¿ç”¨contract-versionsè·¯å¾„ï¼‰
curl -I http://localhost:8000/api/v1/contracts/projects/2/contract-versions/3/download
```

**æŠ€æœ¯è¦ç‚¹**ï¼š
- å¼€å‘ç¯å¢ƒéœ€è¦é…ç½®ä»£ç†è§£å†³è·¨åŸŸé—®é¢˜
- å‰ç«¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„`/api/v1/...`è®¿é—®åç«¯API
- åç«¯æ–‡ä»¶è·¯å¾„å¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„è®¡ç®—
- é‡å¯å‰ç«¯æœåŠ¡æ‰èƒ½åº”ç”¨package.jsonçš„ä»£ç†é…ç½®
- Modal.infoåœ¨æŸäº›ç¯å¢ƒä¸‹å¯èƒ½å¤±æ•ˆï¼Œå»ºè®®ä½¿ç”¨å—æ§Modalç»„ä»¶

#### 7. é‡‡è´­æ¨¡å—å‰ç«¯ç¼–è¯‘é”™è¯¯ (2025-08-08)

**ç—‡çŠ¶**ï¼šé‡‡è´­æ¨¡å—å‰ç«¯ç¼–è¯‘æ—¶å‡ºç°å¤šä¸ªTypeScripté”™è¯¯

**é”™è¯¯ç±»å‹**ï¼š
```typescript
// 1. ContractItemç±»å‹é”™è¯¯
Property 'brand' does not exist on type 'ContractItem'

// 2. Selectç»„ä»¶filterOptionç±»å‹é”™è¯¯  
Type '(input: string, option: any) => boolean' is not assignable

// 3. disabledå±æ€§ç±»å‹é”™è¯¯
Type 'number' is not assignable to type 'boolean | undefined'

// 4. ç»§æ‰¿æ¥å£é”™è¯¯
Types of property 'total_amount' are incompatible
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// 1. ä¿®å¤å­—æ®µåç§°é”™è¯¯
// é”™è¯¯ï¼šitem.brand
// æ­£ç¡®ï¼šitem.brand_model

// 2. ä¿®å¤Selectç»„ä»¶ç±»å‹
filterOption={(input, option) => 
  (option?.children as string)?.toLowerCase().includes(input.toLowerCase())
}

// 3. ä¿®å¤disabledå±æ€§ç±»å‹
disabled={!!selectedProject?.id}

// 4. ä¿®å¤æ¥å£ç»§æ‰¿
export interface PurchaseRequestWithoutPrice extends Omit<PurchaseRequest, 'total_amount'> {
  total_amount?: null;
}
```

#### 8. ç”³è´­å•åŠŸèƒ½é—®é¢˜ä¿®å¤ (2025-08-08)

**é—®é¢˜1**ï¼šç”³è´­å•åˆ›å»ºåæ— æ³•æŸ¥çœ‹
- **ç—‡çŠ¶**ï¼šå¯ä»¥åˆ›å»ºç”³è´­å•ï¼Œä½†åˆ—è¡¨æ— æ³•æ˜¾ç¤ºæ–°åˆ›å»ºçš„æ•°æ®
- **è§£å†³**ï¼šæ·»åŠ å¤šç§æ•°æ®åˆ·æ–°æœºåˆ¶ï¼ˆURLå‚æ•°ã€é¡µé¢ç„¦ç‚¹äº‹ä»¶ï¼‰

**é—®é¢˜2**ï¼šæŸ¥çœ‹æŒ‰é’®æ— å“åº”
- **ç—‡çŠ¶**ï¼šç‚¹å‡»æŸ¥çœ‹æŒ‰é’®æ²¡æœ‰ä»»ä½•ååº”
- **è§£å†³**ï¼šåˆ›å»ºSimplePurchaseDetailç»„ä»¶ï¼Œå®ç°è¯¦æƒ…å¼¹çª—æ˜¾ç¤º

**é—®é¢˜3**ï¼šé¡¹ç›®IDæ˜¾ç¤ºä»£æ›¿é¡¹ç›®åç§°
- **ç—‡çŠ¶**ï¼šåˆ—è¡¨æ˜¾ç¤º"é¡¹ç›®ID: 2"è€Œéå®é™…é¡¹ç›®åç§°
- **è§£å†³**ï¼šåç«¯APIè¿”å›é¡¹ç›®åç§°ï¼Œå‰ç«¯ä¼˜å…ˆæ˜¾ç¤ºåç§°

```python
# backend/app/api/v1/purchases.py
# æ·»åŠ é¡¹ç›®åç§°æŸ¥è¯¢
project = db.query(Project).filter(Project.id == item.project_id).first()
project_name = project.project_name if project else None

# APIå“åº”åŒ…å«é¡¹ç›®åç§°
return {
    "project_name": project_name,
    "requester_name": requester.username if requester else None,
    # å…¶ä»–å­—æ®µ...
}
```

#### 9. ç³»ç»Ÿæµ‹è¯•é¡µé¢æ˜¾ç¤ºé—®é¢˜ (2025-08-08)

**ç—‡çŠ¶**ï¼šç³»ç»Ÿæµ‹è¯•é¡µé¢ä¸æ˜¾ç¤ºä»»ä½•æµ‹è¯•ç»“æœï¼Œä½†åç«¯APIæ­£å¸¸è¿”å›æ•°æ®

**é—®é¢˜å®šä½**ï¼š
```bash
# åç«¯APIæ­£å¸¸è¿”å›27æ¡è®°å½•
curl http://localhost:8000/api/v1/tests/runs | jq '.total'
# è¾“å‡º: 27

# å‰ç«¯é€šè¿‡ä»£ç†è®¿é—®ä¹Ÿæ­£å¸¸
curl http://localhost:3000/api/v1/tests/runs | jq '.total'  
# è¾“å‡º: 27
```

**æ ¹æœ¬åŸå› **ï¼šå‰ç«¯APIè·¯å¾„æœ«å°¾åŒ…å«æ–œæ ï¼Œè€ŒFastAPIè·¯ç”±ä¸æ¥å—æœ«å°¾æ–œæ 

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// frontend/src/services/test.ts
// ä¿®å¤å‰ï¼š
const response = await api.get('tests/runs/', { params });
const response = await api.get(`tests/runs/${runId}/`);
const response = await api.get('tests/statistics/');
const response = await api.get('tests/latest/');

// ä¿®å¤åï¼š
const response = await api.get('tests/runs', { params });
const response = await api.get(`tests/runs/${runId}`);
const response = await api.get('tests/statistics');
const response = await api.get('tests/latest');
```

**éªŒè¯ç»“æœ**ï¼š
- ç§»é™¤æ‰€æœ‰APIè·¯å¾„æœ«å°¾æ–œæ 
- å‰åç«¯è·¯å¾„å®Œå…¨åŒ¹é…
- ç³»ç»Ÿæµ‹è¯•é¡µé¢æ­£å¸¸æ˜¾ç¤º27æ¡å†å²è®°å½•

#### 10. ç”³è´­æ¨¡å—æ™ºèƒ½åŒ–ä¼˜åŒ– (2025-08-08)

**éœ€æ±‚èƒŒæ™¯**ï¼šç”¨æˆ·è¦æ±‚ç”³è´­æ¨¡å—ä¸åˆåŒæ¸…å•æ·±åº¦é›†æˆï¼Œç¡®ä¿ä¸»æä¸¥æ ¼æ¥æºäºåˆåŒæ¸…å•

**ä¼˜åŒ–å†…å®¹**ï¼š
1. **ç‰©æ–™åç§°æ™ºèƒ½é€‰æ‹©**ï¼šä¸»æåªèƒ½ä»åˆåŒæ¸…å•ä¸‹æ‹‰é€‰æ‹©ï¼Œè¾…æå¯è‡ªç”±è¾“å…¥
2. **è§„æ ¼å‹å·è”åŠ¨æ˜¾ç¤º**ï¼šé€‰æ‹©ç‰©æ–™åè‡ªåŠ¨æ˜¾ç¤ºå¯é€‰è§„æ ¼é€‰é¡¹
3. **å“ç‰Œå•ä½è‡ªåŠ¨å¡«å……**ï¼šé€‰æ‹©è§„æ ¼åå“ç‰Œã€å•ä½è‡ªåŠ¨å¡«å……ä¸”ä¸å¯ä¿®æ”¹
4. **æ•°é‡é™åˆ¶éªŒè¯**ï¼šç”³è´­æ•°é‡ä¸èƒ½è¶…è¿‡åˆåŒæ¸…å•å‰©ä½™å¯ç”³è´­æ•°é‡
5. **åˆ†æ‰¹é‡‡è´­æ”¯æŒ**ï¼šæ”¯æŒåŒä¸€ç‰©æ–™å¤šæ¬¡ç”³è´­ï¼ŒåŠ¨æ€è®¡ç®—å‰©ä½™æ•°é‡

**æŠ€æœ¯å®ç°**ï¼š
```typescript
// ç‰©æ–™åç§°è”åŠ¨æŸ¥è¯¢API
export async function getMaterialNamesByProject(projectId: number, itemType: string)

// è§„æ ¼é€‰æ‹©è”åŠ¨API  
export async function getSpecificationsByMaterial(projectId: number, itemName: string)

// æ™ºèƒ½è¡¨å•ç»„ä»¶
<EnhancedPurchaseForm /> // æ›¿ä»£åŸSimplePurchaseForm
```

**å…³é”®æŠ€æœ¯éš¾ç‚¹åŠè§£å†³**ï¼š
- **çŠ¶æ€æ›´æ–°å†²çª**ï¼šå¤šæ¬¡å•ç‹¬updateItemè°ƒç”¨å¯¼è‡´å¼‚æ­¥å†²çª
  ```typescript
  // é—®é¢˜ï¼šå¤šæ¬¡å•ç‹¬æ›´æ–°å¯¼è‡´çŠ¶æ€ä¸¢å¤±
  updateItem(itemId, 'field1', value1);
  updateItem(itemId, 'field2', value2);
  
  // è§£å†³ï¼šæ‰¹é‡çŠ¶æ€æ›´æ–°
  setItems(items => items.map(item => 
    item.id === itemId ? { ...item, field1: value1, field2: value2 } : item
  ));
  ```

- **TypeScriptç±»å‹æ¨æ–­é”™è¯¯**ï¼šupdatedItemå¯¹è±¡å­—æ®µè¢«æ¨æ–­ä¸ºundefinedç±»å‹
  ```typescript
  // è§£å†³ï¼šæ˜¾å¼ç±»å‹æ³¨è§£
  const updatedItem: EnhancedPurchaseItem = { ...item, newField: value };
  ```

#### 11. åˆåŒæ¸…å•æ˜¾ç¤ºå­—æ®µä¿®å¤ (2025-08-08)

**é—®é¢˜ç—‡çŠ¶**ï¼šåˆåŒæ¸…å•é¡µé¢"è®¾å¤‡å‹å·"æ˜¾ç¤ºå“ç‰Œï¼Œ"è®¾å¤‡å“ç‰Œ"æ˜¾ç¤ºå‹å·ï¼Œå®Œå…¨ç›¸å

**é—®é¢˜æ’æŸ¥è¿‡ç¨‹**ï¼š
1. **APIæ•°æ®éªŒè¯**ï¼šç¡®è®¤åç«¯è¿”å›æ•°æ®æ­£ç¡®
   ```bash
   curl -X GET "http://localhost:8000/api/v1/purchases/contract-items/by-project/2"
   # brand_model: "å¤§å", specification: "DH-SH-HFS9541P-I" âœ“
   ```

2. **å‰ç«¯æ˜¾ç¤ºé€»è¾‘æ£€æŸ¥**ï¼šå‘ç°è¡¨æ ¼åˆ—å®šä¹‰å­—æ®µæ˜ å°„é”™è¯¯
3. **Excelè§£æé€»è¾‘éªŒè¯**ï¼šç¡®è®¤æ•°æ®å¯¼å…¥æ˜ å°„æ­£ç¡®

**æ ¹æœ¬åŸå› **ï¼šå‰ç«¯è¡¨æ ¼åˆ—å®šä¹‰ä¸­dataIndexå­—æ®µæ˜ å°„é”™è¯¯
```typescript
// é”™è¯¯çš„æ˜ å°„
{ title: 'è®¾å¤‡å‹å·', dataIndex: 'brand_model' }     // åº”è¯¥æ˜¯specification
{ title: 'è®¾å¤‡å“ç‰Œ', dataIndex: 'specification' }   // åº”è¯¥æ˜¯brand_model
```

**æ•°æ®æµåˆ†æ**ï¼š
```
Excelæ–‡ä»¶ â†’ è§£æå™¨ â†’ æ•°æ®åº“ â†’ API â†’ å‰ç«¯æ˜¾ç¤º
è®¾å¤‡å“ç‰Œ(å¤§å) â†’ brand_modelå­—æ®µ â†’ brand_modelå­—æ®µ â†’ é”™è¯¯æ˜¾ç¤ºåœ¨å‹å·åˆ—
è®¾å¤‡å‹å·(DH-SH-HFS9541P-I) â†’ specificationå­—æ®µ â†’ specificationå­—æ®µ â†’ é”™è¯¯æ˜¾ç¤ºåœ¨å“ç‰Œåˆ—
```

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// ä¿®å¤åçš„æ­£ç¡®æ˜ å°„
{ title: 'è®¾å¤‡å‹å·', dataIndex: 'specification' }   // æ˜¾ç¤ºDH-SH-HFS9541P-I
{ title: 'è®¾å¤‡å“ç‰Œ', dataIndex: 'brand_model' }     // æ˜¾ç¤ºå¤§å
```

**æŠ€æœ¯å¯ç¤º**ï¼š
- å­—æ®µå‘½åä¸å®é™…ç”¨é€”å¯èƒ½ä¸åŒ¹é…ï¼Œéœ€è¦é€šè¿‡æ•°æ®æµè¿½è¸ªç¡®è®¤
- å‰ç«¯æ˜¾ç¤ºé—®é¢˜ä¼˜å…ˆæ£€æŸ¥æ•°æ®æºï¼Œå†æ£€æŸ¥æ˜¾ç¤ºé€»è¾‘
- ä½¿ç”¨curlç­‰å·¥å…·å¿«é€ŸéªŒè¯APIæ•°æ®æ­£ç¡®æ€§

## å¼€å‘æœ€ä½³å®è·µ

### è°ƒè¯•æŠ€å·§æ’åº

1. **APIå‚æ•°å’Œè¿æ¥è°ƒè¯•**ï¼š
   - ä½¿ç”¨`curl`ç›´æ¥æµ‹è¯•åç«¯APIå’Œå‚æ•°
   - æ£€æŸ¥æµè§ˆå™¨Networké¢æ¿çš„å®é™…è¯·æ±‚
   - å¯¹æ¯”å‰åç«¯å‚æ•°å‘½åä¸€è‡´æ€§
   - ç¡®è®¤CORSé…ç½®æ­£ç¡®

2. **Reactæ€§èƒ½å’ŒçŠ¶æ€è°ƒè¯•**ï¼š
   - åˆ›å»ºæœ€å°å¯è¡Œç‰ˆæœ¬æ’é™¤å¤æ‚ä¾èµ–
   - æ£€æŸ¥useEffectä¾èµ–æ•°ç»„é…ç½®
   - æ¸…ç†console.logç­‰è°ƒè¯•è¯­å¥
   - ä½¿ç”¨useCallbackä¼˜åŒ–ç»„ä»¶æ€§èƒ½

3. **æœåŠ¡çŠ¶æ€æ£€æŸ¥**ï¼š
   - `ps aux | grep uvicorn` - æ£€æŸ¥åç«¯è¿›ç¨‹
   - `ps aux | grep node` - æ£€æŸ¥å‰ç«¯è¿›ç¨‹
   - `sudo netstat -tlnp` - æ£€æŸ¥ç«¯å£å ç”¨

4. **æ—¥å¿—åˆ†æ**ï¼š
   - åç«¯ï¼š`tail -f backend/backend.log`
   - å‰ç«¯ï¼š`tail -f frontend/frontend.log`
   - æµè§ˆå™¨ConsoleæŸ¥çœ‹JavaScripté”™è¯¯

5. **CORSè°ƒè¯•**ï¼š
   ```bash
   # æµ‹è¯•CORSé…ç½®æ˜¯å¦æ­£ç¡®
   curl -I -X OPTIONS http://localhost:8000/health \
     -H "Origin: http://localhost:3000" \
     -H "Access-Control-Request-Method: GET"
   ```

### APIå¼€å‘æœ€ä½³å®è·µ

**åŸºäº2025-08-16åˆ†é¡µå‚æ•°é—®é¢˜ç»éªŒæ€»ç»“**

#### 1. å‰åç«¯å‚æ•°å‘½åä¸€è‡´æ€§
```python
# åç«¯APIå®šä¹‰ (FastAPI)
@router.get("/")
async def get_items(
    page: int = Query(1, ge=1),
    size: int = Query(10, ge=1, le=100)  # ä½¿ç”¨'size'è€Œé'page_size'
):
    pass
```

```typescript
// å‰ç«¯APIè°ƒç”¨å¿…é¡»åŒ¹é…
const response = await fetch(`/api/v1/items/?page=${page}&size=${size}`);
```

#### 2. APIå‚æ•°éªŒè¯æµç¨‹
```bash
# å¼€å‘æ—¶éªŒè¯APIå‚æ•°æœ‰æ•ˆæ€§
curl "http://localhost:8000/api/v1/purchases/?page=1&size=20" -H "Authorization: Bearer $TOKEN"

# æ£€æŸ¥è¿”å›æ•°æ®æ˜¯å¦ç¬¦åˆé¢„æœŸ
# {"total": 18, "items": [...], "page": 1, "size": 20}
```

#### 3. TypeScriptç±»å‹å®šä¹‰å¼ºåˆ¶ä¸€è‡´æ€§
```typescript
// å®šä¹‰APIå‚æ•°æ¥å£
interface PaginationParams {
  page: number;
  size: number;  // ç¡®ä¿ä¸åç«¯å‚æ•°åä¸€è‡´
}

// åœ¨APIæœåŠ¡ä¸­ä½¿ç”¨
const getPurchases = (params: PaginationParams) => {
  return api.get(`/purchases/?page=${params.page}&size=${params.size}`);
};
```

### Reactå¼€å‘æœ€ä½³å®è·µ

**åŸºäº2025-08-15æ— é™åŠ è½½é—®é¢˜ç»éªŒæ€»ç»“**

#### 1. ç»„ä»¶æ€§èƒ½ä¼˜åŒ–
```typescript
// âœ… ä½¿ç”¨useCallbacké˜²æ­¢ä¸å¿…è¦çš„é‡æ¸²æŸ“
const loadData = useCallback(async (page = 1, size = 10) => {
  // æ•°æ®åŠ è½½é€»è¾‘
}, [currentPage, pageSize]);

// âœ… æ­£ç¡®é…ç½®useEffectä¾èµ–
useEffect(() => {
  loadData();
}, [loadData]);

// âŒ é¿å…å¤æ‚çš„ç»„ä»¶å¯¼å…¥é“¾
import { ComplexProvider } from './contexts/ComplexContext';
```

#### 2. è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥
```typescript
// âœ… æ¸è¿›å¼ç»„ä»¶å¼€å‘
// 1. åˆ›å»ºæœ€å°å¯è¡Œç‰ˆæœ¬ (AppMinimal.tsx)
// 2. é€æ­¥æ·»åŠ åŠŸèƒ½å¹¶æµ‹è¯•
// 3. å®šä½é—®é¢˜ç»„ä»¶åé’ˆå¯¹æ€§ä¿®å¤

// âœ… æ¸…ç†æ€§èƒ½å½±å“çš„ä»£ç 
// ç§»é™¤å¤šä½™çš„console.log
// ç®€åŒ–çŠ¶æ€ç®¡ç†é€»è¾‘
// é¿å…åœ¨renderä¸­è¿›è¡Œå¤æ‚è®¡ç®—
```

#### 3. çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ
```typescript
// âœ… è®¤è¯çŠ¶æ€ç®€åŒ–
isLoggedIn(): boolean {
  const token = localStorage.getItem('access_token');
  return token !== null && this.currentUser !== null;
}

// âœ… é¿å…çŠ¶æ€æ›´æ–°å†²çª
const handleUpdate = useCallback((id: string, updates: Partial<Item>) => {
  setItems(items => items.map(item => 
    item.id === id ? { ...item, ...updates } : item
  ));
}, []);
```

### æƒé™ç³»ç»Ÿé›†æˆå¼€å‘æµç¨‹

**åŸºäº2025-08-09æƒé™ç³»ç»Ÿå¼€å‘ç»éªŒæ€»ç»“**

#### 1. æƒé™ç³»ç»Ÿå¼€å‘åŸåˆ™
- **æ•°æ®ä¿æŠ¤ä¼˜å…ˆ**ï¼šä»»ä½•ç³»ç»Ÿæ€§ä¿®æ”¹å‰éƒ½è¦éªŒè¯æ•°æ®å®Œæ•´æ€§
- **æ¸è¿›å¼é›†æˆ**ï¼šå…ˆç¡®ä¿ç°æœ‰åŠŸèƒ½æ­£å¸¸ï¼Œå†æ‰©å±•æ–°çš„æƒé™åŠŸèƒ½
- **ä¸šåŠ¡é©±åŠ¨è®¾è®¡**ï¼šæƒé™é…ç½®å¿…é¡»ç¬¦åˆå®é™…ä¸šåŠ¡æµç¨‹éœ€æ±‚

#### 2. å‰ç«¯APIè°ƒç”¨æ ‡å‡†åŒ–
```typescript
// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨fetchç»•è¿‡è®¤è¯
const response = await fetch('/api/v1/purchases/', {
  headers: { 'Content-Type': 'application/json' }
});

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç»Ÿä¸€apiå®ä¾‹è‡ªåŠ¨é™„åŠ token
const response = await api.get('purchases/');
```

#### 3. æƒé™é—®é¢˜è°ƒè¯•é»„é‡‘æµç¨‹
```bash
# ç¬¬ä¸€æ­¥ï¼šæ•°æ®å®Œæ•´æ€§éªŒè¯
curl -s "http://localhost:8000/api/v1/purchases/" -H "Authorization: Bearer $TOKEN"

# ç¬¬äºŒæ­¥ï¼šå‰ç«¯APIè°ƒç”¨å®¡æŸ¥
grep -r "fetch.*api/v1" frontend/src/ --include="*.ts" --include="*.tsx"

# ç¬¬ä¸‰æ­¥ï¼šæƒé™é…ç½®éªŒè¯
curl -X POST "http://localhost:8000/api/v1/auth/login" -d "username=purchaser&password=purchase123"

# ç¬¬å››æ­¥ï¼šè§’è‰²æƒé™è¾¹ç•Œæµ‹è¯•
for role in admin general_manager purchaser; do
  echo "Testing $role permissions..."
  # æµ‹è¯•æ¯ä¸ªè§’è‰²çš„åŠŸèƒ½è®¿é—®æƒé™
done
```

#### 4. è®¤è¯é›†æˆæ£€æŸ¥æ¸…å•
- [ ] æ‰€æœ‰APIè°ƒç”¨ä½¿ç”¨`services/api.ts`è€Œéç›´æ¥`fetch`
- [ ] å‰ç«¯æœ‰å®Œå–„çš„401é”™è¯¯è‡ªåŠ¨é‡æ–°ç™»å½•å¤„ç†
- [ ] åç«¯æƒé™é…ç½®ä¸ä¸šåŠ¡æµç¨‹åŒ¹é…
- [ ] ä¸åŒè§’è‰²çš„åŠŸèƒ½æƒé™è¾¹ç•Œæµ‹è¯•é€šè¿‡
- [ ] åŸæœ‰æ•°æ®100%å®Œæ•´æ€§ä¿æŒ

### å¼€å‘æµç¨‹

1. **å¼€å‘ç¯å¢ƒ**ï¼š
   - ä½¿ç”¨VSCode Remote SSH
   - å‰ç«¯localhost:3000ï¼Œåç«¯localhost:8000
   - ä¿æŒå‰åç«¯ç«¯å£ä¸€è‡´æ€§

2. **ä»£ç è´¨é‡**ï¼š
   - åŠæ—¶ä¿®å¤ESLintè­¦å‘Š
   - ä½¿ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼
   - æ­£ç¡®ä½¿ç”¨React Hooksè§„èŒƒ

3. **éƒ¨ç½²æµç¨‹**ï¼š
   - å¼€å‘ç¯å¢ƒä½¿ç”¨start-erp-dev.sh
   - ç”Ÿäº§ç¯å¢ƒé€šè¿‡nginxåå‘ä»£ç†
   - å®šæœŸå¤‡ä»½æ•°æ®åº“

4. **è°ƒè¯•åŸåˆ™**ï¼š
   - ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·
   - æ£€æŸ¥ç½‘ç»œé…ç½®
   - ä½¿ç”¨æœåŠ¡å™¨ç«¯æ—¥å¿—æ’æŸ¥

## AWSéƒ¨ç½²æ³¨æ„äº‹é¡¹

### å®‰å…¨ç»„é…ç½®
ç¡®ä¿EC2å®ä¾‹å®‰å…¨ç»„å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š

| ç«¯å£ | ç”¨é€” | æ¥æº |
|------|------|------|
| 22 | SSHè®¿é—® | æ‚¨çš„IP |
| 8000 | åç«¯API | 0.0.0.0/0 |
| 3000 | å‰ç«¯(å¼€å‘) | 0.0.0.0/0 |
| 8080 | å‰ç«¯(ç”Ÿäº§) | 0.0.0.0/0 |

### é…ç½®æ­¥éª¤
1. ç™»å½•AWSæ§åˆ¶å°
2. è¿›å…¥EC2 â†’ å®ä¾‹ â†’ é€‰æ‹©å®ä¾‹
3. å®‰å…¨æ ‡ç­¾ â†’ ç‚¹å‡»å®‰å…¨ç»„
4. ç¼–è¾‘å…¥ç«™è§„åˆ™ â†’ æ·»åŠ ä¸Šè¿°ç«¯å£
5. ä¿å­˜æ›´æ”¹

## å¸¸è§æ“ä½œ

é‡åˆ°é—®é¢˜æ—¶çš„æ£€æŸ¥æ¸…å•ï¼š
1. æŸ¥çœ‹[æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)éƒ¨åˆ†
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
3. ä½¿ç”¨è¯Šæ–­è„šæœ¬ï¼š`./scripts/diagnose-frontend.sh`
4. ç¡®è®¤AWSå®‰å…¨ç»„é…ç½®æ­£ç¡®

## ğŸ“š å­¦ä¹ èµ„æº

### æŠ€æœ¯æ–‡æ¡£
- [ç½‘ç»œè®¿é—®åŸç†å­¦ä¹ æŒ‡å—](docs/ç½‘ç»œè®¿é—®åŸç†å­¦ä¹ æŒ‡å—.md) - æ·±å…¥ç†è§£å‰åç«¯ç½‘ç»œé€šä¿¡åŸç†
- [è„šæœ¬ä½¿ç”¨è¯´æ˜](scripts/README.md) - è¯¦ç»†çš„éƒ¨ç½²è„šæœ¬æ–‡æ¡£

### å¼€å‘è®°å½•
- [CLAUDE.md](CLAUDE.md) - é¡¹ç›®å¼€å‘è®°å½•å’Œé—®é¢˜è§£å†³å†å²

## 12. ç³»ç»Ÿæµ‹è¯•åŠŸèƒ½ä¿®å¤ï¼ˆ2025-08-09ï¼‰

### é—®é¢˜æè¿°
1. **çŠ¶æ€æ˜¾ç¤ºé”™è¯¯**ï¼š37ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œä½†ç³»ç»Ÿæµ‹è¯•æ±‡æ€»é¡µé¢æ˜¾ç¤ºçŠ¶æ€ä¸º"å¤±è´¥"
2. **æµ‹è¯•ç»“æœä¸æ˜¾ç¤º**ï¼šç‚¹å‡»æµ‹è¯•è¿è¡ŒIDåï¼Œæµ‹è¯•ç»“æœé¡µé¢ä¸æ˜¾ç¤ºä»»ä½•æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…

### æ ¹æœ¬åŸå› åˆ†æ

#### é—®é¢˜1ï¼šçŠ¶æ€åˆ¤æ–­é€»è¾‘ç¼ºé™·
- **æ–‡ä»¶ä½ç½®**ï¼š`backend/app/api/v1/test_results.py` ç¬¬202è¡Œ
- **åŸå› **ï¼šçŠ¶æ€åˆ¤æ–­ä¾èµ–`process.returncode == 0`ï¼Œå³ä½¿æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œå¦‚æœpytestè¿›ç¨‹è¿”å›ç ä¸ä¸º0ä»ä¼šæ ‡è®°ä¸ºå¤±è´¥
- **ä»£ç é—®é¢˜**ï¼š
  ```python
  # åŸé€»è¾‘
  test_run.status = "completed" if failed == 0 and process.returncode == 0 else "failed"
  ```

#### é—®é¢˜2ï¼šç¼ºå°‘è¯¦ç»†æµ‹è¯•ç»“æœä¿å­˜
- **åŸå› **ï¼šæ‰‹åŠ¨è§¦å‘æµ‹è¯•æ—¶åªä¿å­˜äº†TestRunè®°å½•ï¼Œæ²¡æœ‰ä¿å­˜TestResultè¯¦ç»†è®°å½•
- **ç¼ºå¤±åŠŸèƒ½**ï¼š
  1. æ²¡æœ‰è§£æpytestè¾“å‡ºæå–å•ä¸ªæµ‹è¯•ç”¨ä¾‹ç»“æœ
  2. ç¼ºå°‘`/api/v1/tests/results/{run_id}`ç«¯ç‚¹

### è§£å†³æ–¹æ¡ˆå®æ–½

#### ä¿®å¤1ï¼šæ”¹è¿›çŠ¶æ€åˆ¤æ–­é€»è¾‘
```python
# ä¿®å¤åçš„é€»è¾‘
passed = output.count(' PASSED')
failed = output.count(' FAILED')
skipped = output.count(' SKIPPED')
error = output.count(' ERROR')
total = passed + failed + skipped + error

# åªè¦æ²¡æœ‰å¤±è´¥å’Œé”™è¯¯å°±æ˜¯æˆåŠŸï¼Œä¸ä¾èµ–è¿›ç¨‹è¿”å›ç 
test_run.status = "completed" if failed == 0 and error == 0 else "failed"
```

#### ä¿®å¤2ï¼šä¿å­˜è¯¦ç»†æµ‹è¯•ç»“æœ
```python
# è§£æpytestè¾“å‡ºï¼Œä¿å­˜æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹
from app.models.test_result import TestResult
test_lines = output.split('\n')
for line in test_lines:
    if ' PASSED' in line or ' FAILED' in line:
        # è§£ææµ‹è¯•åç§°å’ŒçŠ¶æ€
        parts = line.split('::')
        test_suite = test_file.replace('tests/', '').replace('.py', '')
        test_result = TestResult(
            test_run_id=run_id,
            test_suite=test_suite,
            test_name=test_name,
            status=status
        )
        db.add(test_result)
```

#### ä¿®å¤3ï¼šæ·»åŠ æµ‹è¯•ç»“æœAPIç«¯ç‚¹
```python
@router.get("/results/{run_id}")
def get_test_results(run_id: str, db: Session = Depends(get_db)):
    """è·å–æŒ‡å®šæµ‹è¯•è¿è¡Œçš„è¯¦ç»†ç»“æœ"""
    results = db.query(TestResult).filter(
        TestResult.test_run_id == run_id
    ).all()
    return {
        "run_id": run_id,
        "total_results": len(results),
        "results": [result.to_dict() for result in results]
    }
```

### è°ƒè¯•æŠ€å·§æ€»ç»“
1. **APIå“åº”éªŒè¯**ï¼šä½¿ç”¨`curl | jq`ç›´æ¥æŸ¥çœ‹APIå“åº”ï¼Œå¿«é€Ÿå®šä½é—®é¢˜
2. **æ•°æ®æµè¿½è¸ª**ï¼šä»æ•°æ®åº“â†’APIâ†’å‰ç«¯é€å±‚æ£€æŸ¥æ•°æ®ä¼ é€’
3. **æ—¥å¿—åˆ†æ**ï¼šæŸ¥çœ‹pytestè¾“å‡ºæ ¼å¼ï¼Œç†è§£è§£æé€»è¾‘
4. **éš”ç¦»æµ‹è¯•**ï¼šç§»é™¤æœ‰é—®é¢˜çš„æµ‹è¯•æ–‡ä»¶ï¼Œç¡®ä¿å¹²å‡€çš„æµ‹è¯•ç¯å¢ƒ

### éªŒè¯ç»“æœ
- âœ… 36ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ŒçŠ¶æ€æ­£ç¡®æ˜¾ç¤ºä¸º"completed"
- âœ… æµ‹è¯•ç»“æœAPIè¿”å›36ä¸ªè¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹è®°å½•
- âœ… å‰ç«¯èƒ½æ­£ç¡®æ˜¾ç¤ºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„åç§°ã€çŠ¶æ€å’Œæ‰€å±å¥—ä»¶

## æ–‡æ¡£ä¿¡æ¯

**æœ€åæ›´æ–°**ï¼š2025-08-09  
**ç‰ˆæœ¬**ï¼š1.2.1 - ç³»ç»Ÿæµ‹è¯•åŠŸèƒ½ä¿®å¤ï¼Œç”³è´­æ¨¡å—æµ‹è¯•å¥—ä»¶å®Œå–„